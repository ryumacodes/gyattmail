@tailwind base;
@tailwind components;
@tailwind utilities;

/**
 * Paper-Hatch Design System
 * Mood: winter-quiet, engraved, tactile
 * Colors derived from gnome-window reference image
 */

@layer base {
  :root {
    /* Paper-Hatch Tokens (HSL format for Tailwind compatibility) */
    --background: 38 35% 94%;     /* #F4EFE4 - paper0 */
    --foreground: 24 11% 11%;     /* #1F1B17 - ink9 */
    --card: 39 28% 85%;           /* #E8DDC9 - paper1 */
    --card-foreground: 24 11% 11%;
    --popover: 39 28% 85%;
    --popover-foreground: 24 11% 11%;

    --primary: 24 59% 45%;        /* #B7662E - hat6 - gnome cap brown */
    --primary-foreground: 38 35% 94%;

    --secondary: 39 28% 85%;      /* #E8DDC9 - paper1 */
    --secondary-foreground: 23 13% 26%; /* #4D4136 - ink7 */

    --muted: 39 28% 85%;
    --muted-foreground: 27 17% 48%; /* #7A6857 - hatch6 */

    --accent: 28 66% 66%;         /* #E3A46E - hat4 - light accent */
    --accent-foreground: 24 11% 11%;

    --destructive: 9 45% 34%;    /* #7C3A2F - berry5 */
    --destructive-foreground: 38 35% 94%;

    --border: 27 17% 48%;         /* #7A6857 - hatch6 - etched lines */
    --input: 39 28% 85%;
    --ring: 24 59% 45%;           /* #B7662E - hat6 */

    --radius: 14px;            /* artisanal rounded corners */
  }

  .dark {
    /* Dark mode - improved contrast */
    --background: 23 30% 12%;     /* Darker brown background for better contrast */
    --foreground: 38 35% 92%;     /* Cream text, slightly less bright */
    --card: 24 35% 22%;           /* Medium-dark brown for cards - more distinct */
    --card-foreground: 38 35% 92%;
    --popover: 24 35% 22%;        /* Same as card */
    --popover-foreground: 38 35% 92%;

    --primary: 28 66% 68%;        /* Lighter brown accent - more visible */
    --primary-foreground: 24 11% 11%;

    --secondary: 24 35% 22%;      /* Same as card */
    --secondary-foreground: 38 35% 92%;

    --muted: 24 25% 28%;          /* Distinct from card - clearer hierarchy */
    --muted-foreground: 39 25% 70%;  /* Less harsh cream for muted text */

    --accent: 24 55% 50%;         /* Balanced accent color */
    --accent-foreground: 38 35% 92%;

    --destructive: 9 50% 45%;     /* Slightly brighter for visibility */
    --destructive-foreground: 38 35% 92%;

    --border: 27 20% 55%;         /* More visible border in dark mode */
    --input: 24 35% 22%;
    --ring: 28 66% 68%;           /* Match primary */
  }
}

@layer base {
  * {
    @apply border-border;
  }

  body {
    @apply bg-background text-foreground;
    font-feature-settings: "rlig" 1, "calt" 1;
    /* Prevent text from looking too cold */
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
}

/**
 * Paper-Hatch Utilities
 * True artisanal cross-hatching (not simple diagonal lines)
 */

@layer utilities {
  /* Paper grain overlay (subtle texture) */
  .paper-grain {
    position: relative;
  }

  .paper-grain::before {
    content: '';
    position: absolute;
    inset: 0;
    background-image: url('/textures/paper-noise.svg');
    background-size: 240px 240px;
    background-repeat: repeat;
    opacity: 0.18;
    pointer-events: none;
    mix-blend-mode: overlay;
    z-index: 1;
  }

  /* Reduce grain opacity in dark mode for subtler effect */
  .dark .paper-grain::before {
    opacity: 0.08;
  }

  /* Cross-hatch overlay (dual-angle hatching for depth) */
  .hatch {
    position: relative;
  }

  .hatch::before,
  .hatch::after {
    content: '';
    position: absolute;
    inset: 0;
    pointer-events: none;
    mix-blend-mode: multiply;
  }

  .hatch::before {
    background-image: repeating-linear-gradient(
      35deg,
      hsl(var(--border) / 0.28) 0,
      hsl(var(--border) / 0.28) 1px,
      transparent 1px,
      transparent 8px
    );
    opacity: 0.35;
    z-index: 2;
  }

  .hatch::after {
    background-image: repeating-linear-gradient(
      -35deg,
      hsl(var(--border) / 0.22) 0,
      hsl(var(--border) / 0.22) 1px,
      transparent 1px,
      transparent 10px
    );
    opacity: 0.22;
    z-index: 2;
  }

  /* Moir√© safety for high-DPI screens */
  @media (min-resolution: 2dppx) {
    .hatch::before {
      background-size: 12px 12px;
    }
    .hatch::after {
      background-size: 14px 14px;
    }
  }

  /* Hatched separator - horizontal (etched line feel) */
  .separator-hatched {
    height: 2px;
    background-image: repeating-linear-gradient(
      45deg,
      hsl(var(--border)) 0,
      hsl(var(--border)) 1px,
      transparent 1px,
      transparent 4px
    );
    background-size: 6px 6px;
    position: relative;
  }

  .separator-hatched::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(
      -45deg,
      hsl(var(--border) / 0.4) 0,
      hsl(var(--border) / 0.4) 1px,
      transparent 1px,
      transparent 4px
    );
    background-size: 6px 6px;
  }

  /* Hatched separator - vertical */
  .separator-hatched-vertical {
    width: 2px;
    background-image: repeating-linear-gradient(
      45deg,
      hsl(var(--border)) 0,
      hsl(var(--border)) 1px,
      transparent 1px,
      transparent 4px
    );
    background-size: 6px 6px;
    position: relative;
  }

  .separator-hatched-vertical::after {
    content: '';
    position: absolute;
    inset: 0;
    background-image: repeating-linear-gradient(
      -45deg,
      hsl(var(--border) / 0.4) 0,
      hsl(var(--border) / 0.4) 1px,
      transparent 1px,
      transparent 4px
    );
    background-size: 6px 6px;
  }

  /* Full hatched border around element (for panels/cards) */
  .border-hatched {
    position: relative;
    border: 2px solid transparent;
  }

  .border-hatched::before,
  .border-hatched::after {
    content: '';
    position: absolute;
    inset: -2px;
    pointer-events: none;
    border-radius: inherit;
  }

  .border-hatched::before {
    background: repeating-linear-gradient(
      35deg,
      hsl(var(--border)) 0,
      hsl(var(--border)) 1px,
      transparent 1px,
      transparent 4px
    );
    mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    mask-composite: exclude;
    -webkit-mask:
      linear-gradient(#fff 0 0) content-box,
      linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    padding: 2px;
  }

  /* Sketchy icon stroke feel (applied to icon containers) */
  .sketch svg {
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .sketch svg path,
  .sketch svg line,
  .sketch svg polyline,
  .sketch svg polygon {
    stroke-dasharray: 3 2;
    stroke-width: 1.25;
  }

  /* Letterpress effect (inset shadow for pressed buttons) */
  .letterpress {
    box-shadow:
      inset 0 1px 0 rgba(0, 0, 0, 0.18),
      inset 0 -1px 0 rgba(255, 255, 255, 0.25);
  }

  /* Dark mode letterpress - lighter shadows for dark backgrounds */
  .dark .letterpress {
    box-shadow:
      inset 0 1px 0 rgba(0, 0, 0, 0.4),
      inset 0 -1px 0 rgba(255, 255, 255, 0.08);
  }

  /* Soft lift shadow (elevation for cards) */
  .soft-lift {
    box-shadow: 0 12px 28px rgba(31, 27, 23, 0.18);
  }

  /* Dark mode soft lift - darker shadow for depth */
  .dark .soft-lift {
    box-shadow: 0 12px 28px rgba(0, 0, 0, 0.4);
  }

  /* Auto-hiding scrollbar (shows only on hover/scroll) */
  .scrollbar-hide::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  .scrollbar-hide::-webkit-scrollbar-track {
    background: transparent;
  }

  .scrollbar-hide::-webkit-scrollbar-thumb {
    background: hsl(var(--border) / 0);
    border-radius: 4px;
    transition: background 0.2s;
  }

  .scrollbar-hide:hover::-webkit-scrollbar-thumb {
    background: hsl(var(--border) / 0.3);
  }

  .scrollbar-hide::-webkit-scrollbar-thumb:hover {
    background: hsl(var(--border) / 0.5);
  }

  /* Firefox */
  .scrollbar-hide {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    scrollbar-gutter: stable both-edges;
  }

  .scrollbar-hide:hover {
    scrollbar-color: hsl(var(--border) / 0.3) transparent;
  }

  /* Star bounce animation */
  @keyframes starBounce {
    0% {
      transform: scale(1) rotate(0deg);
    }
    50% {
      transform: scale(1.3) rotate(8deg);
    }
    100% {
      transform: scale(1) rotate(0deg);
    }
  }

  .animate-star-bounce {
    animation: starBounce 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
  }

  /* Reduce motion for accessibility */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
  }

  /* High contrast mode adjustments */
  @media (prefers-contrast: high) {
    .hatch::before,
    .hatch::after {
      opacity: 0.6;
    }

    .separator-hatched,
    .separator-hatched-vertical {
      background-color: hsl(var(--border));
      background-image: none;
    }
  }
}

/**
 * Component-specific utilities
 */

@layer components {
  /* Paper card with grain + hatch - use PaperCard component instead */

  /* Outlined pill badges (no fill, just stroke) */
  .badge-outline {
    @apply inline-flex items-center rounded-full border-2 px-3 py-0.5 text-xs font-semibold;
    @apply border-primary text-primary bg-transparent;
  }

  .badge-outline:hover {
    @apply bg-primary/10;
  }
}
